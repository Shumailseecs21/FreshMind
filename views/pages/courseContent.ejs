<%- include('../includes/head.ejs') %>
<link rel="stylesheet" type="text/css" href="/css/course_content.css">
</head>
<body>
<%- include('../includes/navigation.ejs') %>

<section id="Chapter">
    <h1 class="mainHeading"><%= course.name %></h1>
    <h2><%= course.description %></h2>
    <p><%= courseContent.length %> Chapters</p>

    <div class="container1">
        <% courseContent.forEach((chapter, index) => { %>
            <div>
                <h1>Chapter <%= index + 1 %></h1>
                <ul>
                    <% chapter.content.forEach(contentItem => { %>
                        <li>
                            <input type="checkbox" id="<%= contentItem.name + index %>" name="<%= contentItem.name + index %>" />
                            <label for="<%= contentItem.name + index %>">
                                <img src="/images/<%= contentItem.type %>.png" alt="">
                                <a href="<%= contentItem.href %>"><%= contentItem.name %></a>
                            </label>
                        </li>
                    <% }); %>
                </ul>
            </div>
        <% }); %>
            <script>
                // Assuming courseContent is an array of chapters, each containing an array of content items
                function calculateProgress(courseContent) {
                    let totalContentItems = 0;
                    let completedContentItems = 0;

                    // Iterate through chapters and content items to count total and completed items
                    courseContent.forEach(chapter => {
                        totalContentItems += chapter.content.length;
                        chapter.content.forEach(contentItem => {
                            const checkboxId = contentItem.name + chapterIndex; // You need to determine the chapter index
                            const checkbox = document.getElementById(checkboxId);

                            if (checkbox && checkbox.checked) {
                                completedContentItems += 1;
                            }
                        });
                    });

                    // Calculate the progress ratio
                    const progressRatio = totalContentItems === 0 ? 0 : completedContentItems / totalContentItems;

                    // Convert ratio to percentage and return
                    const progressPercentage = Math.round(progressRatio * 100);
                    return `${progressPercentage}%`;
                }
            </script>
        <div class="progress-bar">
            <div class="progress" style="width: <%= calculateProgress(courseContent) %>;"></div>
        </div>
    </div>
</section>

<section id="Chapter">
    <!-- ... existing content ... -->

    <!-- Form for adding new content -->
    <div class="add-content-form">
        <h2>Add New Chapter</h2>
        <form action="/add-content/<%= course._id %>" method="post">
            <div class="form-group">
                <label for="chapterName">Chapter Name:</label>
                <input type="text" id="chapterName" name="chapterName" required>
            </div>
            <div class="form-group">
                <label for="chapterHref">Chapter Link:</label>
                <input type="text" id="chapterHref" name="chapterHref" required>
            </div>
            <div class="form-group">
                <label for="chapterType">Chapter Type:</label>
                <input type="text" id="chapterType" name="chapterType" required>
            </div>
            <!-- Add other fields for content details as needed -->
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <button type="submit">Add Chapter</button>
        </form>
    </div>
</section>

<%- include('../includes/footer.ejs') %>

<%- include('../includes/end.ejs') %>

